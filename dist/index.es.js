import{buildSchema as e,graphqlSync as n,getIntrospectionQuery as t}from"graphql";import{includes as r,filter as i,startsWith as o,has as a,reduce as u,map as s,partition as p}from"lodash";var f=function(e){return a(e,"args")},c=function(e){return a(e,"defaultValue")},d=function(e){return"LIST"===e.kind},m=function(e){return"OBJECT"===e.kind},y=function(e){return"INPUT_OBJECT"===e.kind},_=function(e){return"ENUM"===e.kind},l=function(e){return"SCALAR"===e.kind},T=function(e){return"UNION"===e.kind},N=function(e){return"INTERFACE"===e.kind},I=function(e){return"NON_NULL"===e.kind},g=function(e,n){var t=n&&n.ignoreInternals;return i(e,(function(e){return(m(e)&&!!e.fields||y(e)&&!!e.inputFields||_(e)&&!!e.enumValues||l(e)&&!!e.name||N(e)||T(e))&&(!t||t&&!o(e.name,"__"))}))},v={Boolean:"boolean",String:"string",Int:"integer",Float:"number"},h=function(e){if(d(e))return{type:"array",items:h(e.ofType)};if(I(e))return h(e.ofType);var n=e.name;return r(["OBJECT","INPUT_OBJECT","ENUM","SCALAR","INTERFACE","UNION"],e.kind)?r(["OBJECT","INPUT_OBJECT","ENUM","INTERFACE","UNION"],e.kind)?{$ref:"#/definitions/"+n}:{$ref:"#/definitions/"+n,type:v[n]}:{type:v[n]}};function E(e){if(!e)return!0;try{return JSON.parse(e)}catch(n){return"INVALID_JSON: "+e}}function O(e){if(!e)return{};for(var n,t=/^\s*\+([a-z]([a-zA-z_])*)\(([^)]*)\)\s*$/gm,r="",i=0,o={},a=!1;null!==(n=t.exec(e));)r+=e.substring(i,n.index),n.index===t.lastIndex&&t.lastIndex++,i=t.lastIndex,o[n[1]]=E(n[3]),a=!0;0===i?r=e:i<e.length&&(r+=e.substring(i));var u={};return(r=r.replace(/^$|^\s+|\s+$|\n\n/gm,""))&&(u.description=r.trim()),a&&(u.__decorators=o),u}var b=function(e){return s(i(e,(function(e){return I(e.type)&&!d(e.type.ofType)})),(function(e){return e.name}))},C=function(e,n){if(f(n)){var t=I(n.type)?h(n.type.ofType):h(n.type);e[n.name]={type:"object",properties:{return:t,arguments:{type:"object",properties:u(n.args,C,{}),required:b(n.args)}},required:[]}}else if(c(n)){t=I(n.type)?h(n.type.ofType):h(n.type);e[n.name]=t}return U(e,n),e},k=function(e,n){if(f(n)){var t=I(n.type)?h(n.type.ofType):h(n.type);e[n.name]=t}else if(c(n)){t=I(n.type)?h(n.type.ofType):h(n.type);e[n.name]=t}return U(e,n),e},A=function(e){return function(n,t){var i="definitions"===e?k:C;return m(t)?n[t.name]={type:"object",properties:u(t.fields,i,{}),required:"definitions"===e?b(t.fields):[]}:y(t)?n[t.name]={type:"object",properties:u(t.inputFields,i,{}),required:b(t.inputFields)}:N(t)?n[t.name]={type:"object",properties:u(t.fields,i,{}),required:"definitions"===e?b(t.fields):[]}:_(t)?(n[t.name]={type:"string",anyOf:t.enumValues.map((function(e){var n=O(e.description),t={enum:[e.name],title:n.description||e.name,description:n.description||void 0};return n.__decorators&&(t.__decorators=n.__decorators),t}))},U(n,t)):!function(e){return"SCALAR"===e.kind&&r(["Boolean","String","Int","Float"],e.name)}(t)?l(t)?n[t.name]={type:"object",title:t.name}:T(t)&&(n[t.name]={type:"object",anyOf:t.possibleTypes.map((function(e){return{$ref:"#/definitions/"+e.name}}))}):n[t.name]={type:v[t.name],title:t.name},U(n,t),n}};function U(e,n){var t=n.name,r=O(n.description);r.description&&(e[t].description=r.description),r.__decorators&&(e[t].__decorators=r.__decorators)}var j=function(e,n){var t=n||{ignoreInternals:!0},i=e.__schema,o=i.queryType,a=i.mutationType;if(a){var s=e.__schema.types.find((function(e){return e.name==a.name}));s&&(e.__schema.types.Mutation=s,e.__schema.types.Mutation.name="Mutation")}if(o){var f=e.__schema.types.find((function(e){return e.name==o.name}));f&&(e.__schema.types.Query=f,e.__schema.types.Query.name="Query")}var c=p(e.__schema.types,(function(e){return m(e)&&r(["Query","Mutation"],e.name)})),d=c[0],y=c[1];return{$schema:"http://json-schema.org/draft-06/schema#",properties:u(d,A("properties"),{}),definitions:u(g(y,t),A("definitions"),{})}};function B(r){var i=e(r),o=n(i,t()).data;return j(o)}export{j as fromIntrospectionQuery,B as parseGraphQL};
//# sourceMappingURL=index.es.js.map
