import{includes as e,filter as n,startsWith as t,has as r,reduce as i,map as o,partition as a}from"lodash";var u=function(e){return r(e,"args")},s=function(e){return r(e,"defaultValue")},p=function(e){return"LIST"===e.kind},f=function(e){return"OBJECT"===e.kind},c=function(e){return"INPUT_OBJECT"===e.kind},d=function(e){return"ENUM"===e.kind},m=function(e){return"SCALAR"===e.kind},y=function(e){return"UNION"===e.kind},_=function(e){return"INTERFACE"===e.kind},l=function(e){return"NON_NULL"===e.kind},T=function(e,r){var i=r&&r.ignoreInternals;return n(e,(function(e){return(f(e)&&!!e.fields||c(e)&&!!e.inputFields||d(e)&&!!e.enumValues||m(e)&&!!e.name||_(e)||y(e))&&(!i||i&&!t(e.name,"__"))}))},N={Boolean:"boolean",String:"string",Int:"integer",Float:"number"},I=function(n){if(p(n))return{type:"array",items:I(n.ofType)};if(l(n))return I(n.ofType);var t=n.name;return e(["OBJECT","INPUT_OBJECT","ENUM","SCALAR","INTERFACE","UNION"],n.kind)?e(["OBJECT","INPUT_OBJECT","ENUM","INTERFACE","UNION"],n.kind)?{$ref:"#/definitions/"+t}:{$ref:"#/definitions/"+t,type:N[t]}:{type:N[t]}};function g(e){if(!e)return!0;try{return JSON.parse(e)}catch(n){return"INVALID_JSON: "+e}}function v(e){if(!e)return{};for(var n,t=/^\s*\+([a-z]([a-zA-z_])*)\(([^)]*)\)\s*$/gm,r="",i=0,o={},a=!1;null!==(n=t.exec(e));)r+=e.substring(i,n.index),n.index===t.lastIndex&&t.lastIndex++,i=t.lastIndex,o[n[1]]=g(n[3]),a=!0;0===i?r=e:i<e.length&&(r+=e.substring(i));var u={};return(r=r.replace(/^$|^\s+|\s+$|\n\n/gm,""))&&(u.description=r.trim()),a&&(u.__decorators=o),u}var h=function(e){return o(n(e,(function(e){return l(e.type)&&!p(e.type.ofType)})),(function(e){return e.name}))},E=function(e,n){if(u(n)){var t=l(n.type)?I(n.type.ofType):I(n.type);e[n.name]={type:"object",properties:{return:t,arguments:{type:"object",properties:i(n.args,E,{}),required:h(n.args)}},required:[]}}else if(s(n)){t=l(n.type)?I(n.type.ofType):I(n.type);e[n.name]=t}return C(e,n),e},O=function(e,n){if(u(n)){var t=l(n.type)?I(n.type.ofType):I(n.type);e[n.name]=t}else if(s(n)){t=l(n.type)?I(n.type.ofType):I(n.type);e[n.name]=t}return C(e,n),e},b=function(n){return function(t,r){var o="definitions"===n?O:E;return f(r)?t[r.name]={type:"object",properties:i(r.fields,o,{}),required:"definitions"===n?h(r.fields):[]}:c(r)?t[r.name]={type:"object",properties:i(r.inputFields,o,{}),required:h(r.inputFields)}:_(r)?t[r.name]={type:"object",properties:i(r.fields,o,{}),required:"definitions"===n?h(r.fields):[]}:d(r)?(t[r.name]={type:"string",anyOf:r.enumValues.map((function(e){var n=v(e.description),t={enum:[e.name],title:n.description||e.name,description:n.description||void 0};return n.__decorators&&(t.__decorators=n.__decorators),t}))},C(t,r)):!function(n){return"SCALAR"===n.kind&&e(["Boolean","String","Int","Float"],n.name)}(r)?m(r)?t[r.name]={type:"object",title:r.name}:y(r)&&(t[r.name]={type:"object",anyOf:r.possibleTypes.map((function(e){return{$ref:"#/definitions/"+e.name}}))}):t[r.name]={type:N[r.name],title:r.name},C(t,r),t}};function C(e,n){var t=n.name,r=v(n.description);r.description&&(e[t].description=r.description),r.__decorators&&(e[t].__decorators=r.__decorators)}var k=function(n,t){var r=t||{ignoreInternals:!0},o=n.__schema,u=o.queryType,s=o.mutationType;if(s){var p=n.__schema.types.find((function(e){return e.name==s.name}));p&&(n.__schema.types.Mutation=p,n.__schema.types.Mutation.name="Mutation")}if(u){var c=n.__schema.types.find((function(e){return e.name==u.name}));c&&(n.__schema.types.Query=c,n.__schema.types.Query.name="Query")}var d=a(n.__schema.types,(function(n){return f(n)&&e(["Query","Mutation"],n.name)})),m=d[0],y=d[1];return{$schema:"http://json-schema.org/draft-06/schema#",properties:i(m,b("properties"),{}),definitions:i(T(y,r),b("definitions"),{})}};export{k as fromIntrospectionQuery};
//# sourceMappingURL=index.es.js.map
