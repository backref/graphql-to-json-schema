"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("graphql"),n=require("lodash"),t=function(e){return n.has(e,"args")},r=function(e){return n.has(e,"defaultValue")},i=function(e){return"LIST"===e.kind},o=function(e){return"OBJECT"===e.kind},u=function(e){return"INPUT_OBJECT"===e.kind},a=function(e){return"ENUM"===e.kind},s=function(e){return"SCALAR"===e.kind},p=function(e){return"UNION"===e.kind},c=function(e){return"INTERFACE"===e.kind},f=function(e){return"NON_NULL"===e.kind},d=function(e,t){var r=t&&t.ignoreInternals;return n.filter(e,(function(e){return(o(e)&&!!e.fields||u(e)&&!!e.inputFields||a(e)&&!!e.enumValues||s(e)&&!!e.name||c(e)||p(e))&&(!r||r&&!n.startsWith(e.name,"__"))}))},m={Boolean:"boolean",String:"string",Int:"integer",Float:"number"},y=function(e){if(i(e))return{type:"array",items:y(e.ofType)};if(f(e))return y(e.ofType);var t=e.name;return n.includes(["OBJECT","INPUT_OBJECT","ENUM","SCALAR","INTERFACE","UNION"],e.kind)?n.includes(["OBJECT","INPUT_OBJECT","ENUM","INTERFACE","UNION"],e.kind)?{$ref:"#/definitions/"+t}:{$ref:"#/definitions/"+t,type:m[t]}:{type:m[t]}};function l(e){if(!e)return!0;try{return JSON.parse(e)}catch(n){return"INVALID_JSON: "+e}}function _(e){if(!e)return{};for(var n,t=/^\s*\+([a-z]([a-zA-z_])*)\(([^)]*)\)\s*$/gm,r="",i=0,o={},u=!1;null!==(n=t.exec(e));)r+=e.substring(i,n.index),n.index===t.lastIndex&&t.lastIndex++,i=t.lastIndex,o[n[1]]=l(n[3]),u=!0;0===i?r=e:i<e.length&&(r+=e.substring(i));var a={};return(r=r.replace(/^$|^\s+|\s+$|\n\n/gm,""))&&(a.description=r.trim()),u&&(a.__decorators=o),a}var T=function(e){return n.map(n.filter(e,(function(e){return f(e.type)&&!i(e.type.ofType)})),(function(e){return e.name}))},h=function(e,i){if(t(i)){var o=f(i.type)?y(i.type.ofType):y(i.type);e[i.name]={type:"object",properties:{return:o,arguments:{type:"object",properties:n.reduce(i.args,h,{}),required:T(i.args)}},required:[]}}else if(r(i)){o=f(i.type)?y(i.type.ofType):y(i.type);e[i.name]=o}return g(e,i),e},I=function(e,n){if(t(n)){var i=f(n.type)?y(n.type.ofType):y(n.type);e[n.name]=i}else if(r(n)){i=f(n.type)?y(n.type.ofType):y(n.type);e[n.name]=i}return g(e,n),e},N=function(e){return function(t,r){var i="definitions"===e?I:h;return o(r)?t[r.name]={type:"object",properties:n.reduce(r.fields,i,{}),required:"definitions"===e?T(r.fields):[]}:u(r)?t[r.name]={type:"object",properties:n.reduce(r.inputFields,i,{}),required:T(r.inputFields)}:c(r)?t[r.name]={type:"object",properties:n.reduce(r.fields,i,{}),required:"definitions"===e?T(r.fields):[]}:a(r)?(t[r.name]={type:"string",anyOf:r.enumValues.map((function(e){var n=_(e.description),t={enum:[e.name],title:n.description||e.name,description:n.description||void 0};return n.__decorators&&(t.__decorators=n.__decorators),t}))},g(t,r)):!function(e){return"SCALAR"===e.kind&&n.includes(["Boolean","String","Int","Float"],e.name)}(r)?s(r)?t[r.name]={type:"object",title:r.name}:p(r)&&(t[r.name]={type:"object",anyOf:r.possibleTypes.map((function(e){return{$ref:"#/definitions/"+e.name}}))}):t[r.name]={type:m[r.name],title:r.name},g(t,r),t}};function g(e,n){var t=n.name,r=_(n.description);r.description&&(e[t].description=r.description),r.__decorators&&(e[t].__decorators=r.__decorators)}var v=function(e,t){var r=t||{ignoreInternals:!0},i=e.__schema,u=i.queryType,a=i.mutationType;if(a){var s=e.__schema.types.find((function(e){return e.name==a.name}));s&&(e.__schema.types.Mutation=s,e.__schema.types.Mutation.name="Mutation")}if(u){var p=e.__schema.types.find((function(e){return e.name==u.name}));p&&(e.__schema.types.Query=p,e.__schema.types.Query.name="Query")}var c=n.partition(e.__schema.types,(function(e){return o(e)&&n.includes(["Query","Mutation"],e.name)})),f=c[0],m=c[1];return{$schema:"http://json-schema.org/draft-06/schema#",properties:n.reduce(f,N("properties"),{}),definitions:n.reduce(d(m,r),N("definitions"),{})}};exports.fromIntrospectionQuery=v,exports.parseGraphQL=function(n){var t=e.buildSchema(n),r=e.graphqlSync(t,e.getIntrospectionQuery()).data;return v(r)};
//# sourceMappingURL=index.js.map
